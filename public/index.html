<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Remote Youtube API</title>
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="css/bootstrap-theme.min.css" type="text/css">
<link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
<style type="text/css">
body{
	background-color:#eee;
}
</style>
</head>

<body>

<div class="container">
	<div class="jumbotron col-xs-10 col-md-10 col-sm-10 col-lg-10">
	
	  <h2>Remote Youtube 
		<span class="hidden-xs hidden-sm">(Desktop)</span>
		<span class="hidden-md hidden-xs hidden-lg">(Tablet)</span>
		<span class="hidden-sm hidden-md hidden-lg">(Mobile)</span>
	  </h2>
	  <p>Youtube Control API is a video-sharing website head-quartered in San Bruno, California. The service was created by three former PayPal employees in February 2005.</p>
	  <p><a class="btn btn-primary btn-lg" href="https://github.com/wcyz666" role="button"><i class="fa fa-github"></i> Find me on GitHub</a></p>
	</div>
	<p class="pull-right text-right col-xs-2 col-md-2 col-sm-2 col-lg-2"><img id="qrcode" class="img-responsive" src="" alt="QR Code"/></p>
</div>	
<div class="container">
	<div class="panel panel-default">
		<div class="panel-body">
			<div class="row">
				<div class="hidden-xs hidden-sm col-md-9 col-lg-9">
					<div class="panel panel-success">
						<div class="panel-heading">YouTube Player</div>
						<div class="panel-body">
						    <div id="player"></div>
						</div>
					</div>
				</div>
				<div class="col-md-3 col-lg-3">
					<div class="panel panel-danger">
						<div class="panel-heading">YouTube Remote Control</div>
						<div class="panel-body">
						<div class="container-fluid">
							<div class="row">
								<div class="center-block">
									<div id="play" class="bg-success text-center col-xs-4 video-control">
										<i class="fa fa-play fa-2x"></i><span class="hidden-md hidden-xs hidden-lg"> PLAY</span>
									</div>
									<div id="pause" class="bg-danger text-center col-xs-4 video-control">
										<i class="fa fa-pause fa-2x"></i><span class="hidden-md hidden-xs hidden-lg"> PAUSE</span>
									</div>
									<div id="stop" class="bg-warning text-center col-xs-4 video-control">
										<i class="fa fa-stop fa-2x"></i><span class="hidden-md hidden-xs hidden-lg"> STOP</span>
									</div>
								</div>
								<br><br><br>
								<div class="center-block">
									<div id="prev" class="bg-info text-center col-xs-3 video-control">
										<i class="fa fa-fast-backward fa-2x"></i><span class="hidden-md hidden-xs hidden-lg"> PREVIOUS</span>
									</div>
									<div id="rewind" class="bg-info text-center col-xs-3 video-control">
										<i class="fa fa-backward fa-2x"></i><span class="hidden-md hidden-xs hidden-lg"> REWIND</span>
									</div>
									<div id="forward" class="bg-primary text-center col-xs-3 video-control">
										<i class="fa fa-forward fa-2x fa-inverse"></i><span class="hidden-md hidden-xs hidden-lg"> FORWARD</span>
									</div>
									<div id="next" class="bg-primary text-center col-xs-3 video-control">
										<i class="fa fa-fast-forward fa-2x fa-inverse"></i><span class="hidden-md hidden-xs hidden-lg"> NEXT</span>
									</div>
								</div>
								<br><br><br>
								<div class="center-block">
									<div id="unmute" class="bg-warning text-center col-xs-6 video-control">
										<i class="fa fa-volume-up fa-2x "></i><span class="hidden-md hidden-xs hidden-lg"> UNMUTE</span>
									</div>
									<div id="mute" class="bg-warning text-center col-xs-6 video-control">
										<i class="fa fa-volume-off fa-2x"></i><span class="hidden-md hidden-xs hidden-lg"> MUTE</span>
									</div>
		
								</div>
							</div>
						</div>
						</div>
					</div>				
					<div class="panel panel-warning">
						<div class="panel-heading">YouTube PlayList</div>
						<div class="panel-body">
							<ul class="nav nav-pills nav-stacked">
							</ul>
							<br>
							<form class="form" action="" id="video">
							  <div class="form-group col-xs-10">
								  <input type="text" class="form-control" id="video_id" placeholder="Video ID or URL">
							  </div>
							  <button type="submit" class="btn btn-primary col-xs-2"><i class="fa fa-plus-square"></i></button>
							</form>
                            <button class="btn btn-default center-block col-xs-12" id="clearall">Clear All</button>
						</div>
					</div>	
				</div>
			</div>
		</div>
	</div>
</div>


<div class="container">
<footer class="footer"><p class="text-center">Wang Cheng, 2015. All Right reserved.</p></footer>
</div>

</body>
<script src="js/bootstrap.min.js" type="javascript"></script>
<script src="js/myLib.js" type="javascript"></script>
<script>


window.el = function(id, rg){
    var range = rg || document;
    return range.getElementById(id);
};
window.qs = function(selector, rg){
    var range = rg || document;
    return range.querySelector(selector);
};

window.qsa = function(selector, rg){
    var range = rg || document;
    return range.querySelectorAll(selector);
};

window.createNode = function(tag, child, attrs){
    var outerTag = document.createElement(tag);
    var content;
    if (typeof child === "string"){
        content = document.createTextNode(child);
        outerTag.appendChild(content);
    }
    else {
        if (child instanceof Array){
            for (var index in child) {

                content = child[index];
                if (typeof content === "string") {
                    content = document.createTextNode(content);
                }
                else if (typeof content === "function")
                    continue;
                outerTag.appendChild(content);
            }
        }
        else{
            outerTag.appendChild(child);
        }
    }

    for (var key in attrs) {
        outerTag.setAttribute(key, attrs[key]);
    }
    return outerTag;
};

Node.prototype.appendChildren = function(children){
    for (var child in children){
        this.appendChild(child);
    }
};
String.prototype.escapeHTML = function() {
    return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
};
String.prototype.escapeQuotes = function() {
    return this.replace(/"/g,'&quot;').replace(/'/g,'&#39;');
};

window.getList = function(){
    var object = {};

    for (var key in window.localStorage){
        object[key] = window.localStorage[key];
    }
    return object;
};

window.removeList = function(){
    var object = {};

    for (var key in window.localStorage){
        window.localStorage.removeItem(key)
    }
};


Array.prototype.removeAt = function(from, to) {
    var rest = this.slice((to || from) + 1 || this.length);
    this.length = from < 0 ? this.length + from : from;
    return this.push.apply(this, rest);
};

NodeList.prototype.forEach = Array.prototype.forEach;

window.getVideoIds = function(){
    var list = window.getList();
    var ids = [];
    for (var id in list)
        ids.push(id);

    return ids;
};

var player;

function MyYT(){
    var outer = this;
    this.playList = qs("ul.nav");
    this.playList.form = qs("form");
    this.current = 0;
    this.playList.ids = getVideoIds();

    this.playList.getList = window.getList;

    this.playList.generateLi = function(id, title){
        var closeChar = createNode("span", "Ã—", {"aria-hidden" : true});
        var closeBtn = createNode("button", closeChar, {"class": "close pull-right", "type": "button"});
        var arch = createNode("a", [id + " : " + title, closeBtn], {"name": id});
        var li = createNode("li", arch, {"role": "presentation"});
        li.style.cursor = "pointer";
        outer.playList.listEventBinding(li);
        outer.playList.closeEventBinding(closeChar);
        return li;
    };


    this.playList.generateHTML = function(localList){
        for (var key in localList) {
            var listItem = outer.playList.generateLi(key, localList[key]);
            outer.playList.appendChild(listItem);
        }
    };

    this.playList.listBinding = function () {
        outer.playList.removeChar = qsa("span[aria-hidden]", outer.playList);
        outer.playList.list = qsa("ul.nav li");
    };

    this.playList.getIndexById = function (id){
        var index = 0;
        for (index in outer.playList.ids){
            if (outer.playList.ids[index] == id)
                break;
            index++;
            console.log(index);
        }
        return parseInt(index);
    };

    this.playList.listEventBinding = function(li){
        li.addEventListener('click', function(){
            if (qs('.active', outer.playList))
                qs('.active', outer.playList).className = "";
            li.className = "active";
            var index = outer.playList.getIndexById( li.firstElementChild.getAttribute("name"))
            outer.current = index;
            player.loadVideoById( outer.playList.ids[index] );
            return false;
        });
    };

    this.playList.closeEventBinding = function(closeChar){
        closeChar.addEventListener('click', function(event){
            event.stopPropagation();
            var item = this.parentNode.parentNode.parentNode;
            var index = outer.playList.getIndexById(this.parentNode.parentNode.getAttribute("name"));
            window.localStorage.removeItem(outer.playList.ids[index]);
            outer.playList.ids.removeAt(index);
            outer.playList.removeChild(item);
            if (outer.playList.list[index].className == "active" && outer.playList.ids.length > 0) {
                outer.playList.firstElementChild.className = "active";
                player.loadVideoById( outer.playList.ids[0] );
                outer.current = 0;
            }
            if (outer.playList.ids.length == 0)
                player = null;
            outer.playList.listBinding();
            index = 0;
            for (index in outer.playList.ids){
                if (outer.playList.list[index].className == "active")
                    break;
                index++;
            }
            outer.current = parseInt(index);
            return false;
        });
    };

    this.playList.init = function(){

        outer.playList.generateHTML(outer.playList.getList());

        outer.playList.listBinding();

        qsa(".video-control").forEach(function(value, index){
            value.style.cursor = "pointer";
        });


        el("clearall").onclick = function(){
            window.removeList();
            outer.current = 0;
            player = null;
            outer.playList.ids = [];
            while (outer.playList.firstChild) {
                outer.playList.removeChild(outer.playList.firstChild);
            }
            outer.playList.listBinding();
        };


        outer.playList.form.onsubmit = function(){
            var id = "AIMP7TGcNuE";
            var title = "aaa";
            var localList = {};
            localList[id] = title;
            outer.playList.generateHTML(localList);
            outer.playList.listBinding();
            localStorage.setItem(id, title);
            outer.playList.ids.push(id);

            return false;
        };

        if (outer.playList.ids.length > 0)
            outer.playList.firstElementChild.className = "active"

    };

    this.init = function() {
        outer.playList.init();
    };

    this.processQR = function(id, url){
        el(id).src = "https://chart.googleapis.com/chart?cht=qr&chs=500x500&chl=" + encodeURIComponent(url);
    };

    this.createPlayer = function(){
        var player;
        if (outer.playList.ids.length > 0) {
            player = new YT.Player('player', {
                height: '390',
                width: '640',
                playerVars: {'controls': 0},
                videoId: outer.playList.ids[outer.current],
                events: {
                    'onReady': function () {
                        el('play').onclick = function () {
                            player.playVideo();
                        };
                        el('pause').onclick = function () {
                            player.pauseVideo();
                        };
                        el('stop').onclick = function () {
                            player.stopVideo();
                        };
                        el('mute').onclick = function () {
                            player.mute();
                        };
                        el('unmute').onclick = function () {
                            player.unMute();
                        };
                        el('rewind').onclick = function () {
                            currentTime = player.getCurrentTime();
                            player.seekTo(currentTime - 2.0);
                        };
                        el('forward').onclick = function () {
                            currentTime = player.getCurrentTime();
                            player.seekTo(currentTime + 2.0);
                        };
                        el('next').onclick = function () {
                            outer.current++;
                            if (outer.current == outer.playList.ids.length)
                                outer.current = 0;
                            player.loadVideoById( outer.playList.ids[outer.current] );
                            if (qs('.active', outer.playList))
                                qs('.active', outer.playList).className = "";
                            outer.playList.list[outer.current].className = "active";
                        };
                        el('prev').onclick = function () {
                            outer.current--;
                            if (outer.current < 0)
                                outer.current = outer.playList.list.length - 1;
                            player.loadVideoById( outer.playList.ids[outer.current] );
                            if (qs('.active', outer.playList))
                                qs('.active', outer.playList).className = "";
                            outer.playList.list[outer.current].className = "active";
                        }
                    },
                    'onStateChange': function onPlayerStateChange(event){
                            switch( event.data ) {
                                case YT.PlayerState.ENDED:

                                    outer.current++;
                                    if (outer.current == outer.playList.ids.length)
                                        outer.current = 0;
                                    player.loadVideoById(outer.playList.ids[outer.current]);
                                    if (qs('.active', outer.playList))
                                        qs('.active', outer.playList).className = "";
                                    outer.playList.list[outer.current].className = "active";
                                    break;
                                case YT.PlayerState.PLAYING:
                                    // ...
                                    break;
                                case YT.PlayerState.PAUSED:
                                    // ...
                                    break;
                                case YT.PlayerState.BUFFERING:
                                    // ...
                                    break;
                                case YT.PlayerState.CUED:
                                    // ...
                                    break;
                                default:
                                // ...
                            }
                    }
                }
            })
        }
        else{
            player = null;
        }
        return player;
    }

}

myYT = new MyYT();
myYT.init();
myYT.processQR("qrcode", "http://www.baidu.com");


var tag = document.createElement( 'script' );
tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName( 'script' )[ 0 ];
firstScriptTag.parentNode.insertBefore( tag, firstScriptTag );

function onYouTubeIframeAPIReady() {
    player = myYT.createPlayer();
}

window.addEventListener( 'resize', function() {
    if ( window.innerWidth >= 992 ) {
        if ( player === null ) {
            player = myYT.createPlayer();
        }
    } else {
        player.destroy(); // Destroy the video player
        player = null;
    }
} );

</script>
</html>
